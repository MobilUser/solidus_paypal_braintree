<% id = payment_method.id %>

<fieldset class="braintree-hosted-fields" data-braintree-hosted-fields data-id="<%= id %>">
  <%= render partial: "spree/shared/braintree_hosted_fields", locals: { id: id } %>
</fieldset>

<script>
  $(function() {
    var $paymentForm = $("#checkout_form_payment"),
        $hostedFields = $("[data-braintree-hosted-fields]");

    function braintreeError(err) {
      alert(err.name + ": " + err.message);
    }

    $hostedFields.each(function() {
      var $this = $(this);
      var id = $this.data("id");

      BraintreeHostedFields.getToken(id).
        then(BraintreeHostedFields.createClient).
        then(BraintreeHostedFields.createHostedFields(id)).
        then(BraintreeHostedFields.addFormHook($paymentForm, $this, braintreeError)).
        fail(braintreeError)
    });
  });
</script>
